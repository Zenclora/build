#!/bin/bash

# DNS Changer Utility
# Allows switching between popular DNS providers or setting a custom one.

set -e

# Check for root privileges
if [[ $EUID -ne 0 ]]; then
   echo "This script must be run with sudo!"
   exit 1
fi

# Function to update resolv.conf
set_dns() {
    local provider=$1
    local dns1=$2
    local dns2=$3

    echo "--- Applying $provider DNS ---"
    
    # Backup existing resolv.conf
    if [ ! -f /etc/resolv.conf.bak ]; then
        echo "Creating backup of /etc/resolv.conf..."
        sudo cp /etc/resolv.conf /etc/resolv.conf.bak
    fi

    # Write new DNS
    echo "nameserver $dns1" | sudo tee /etc/resolv.conf > /dev/null
    if [ -n "$dns2" ]; then
        echo "nameserver $dns2" | sudo tee -a /etc/resolv.conf > /dev/null
    fi

    echo "DNS successfully changed to $provider!"
}

# Main Menu
clear
echo "=========================================="
echo "          Zenclora DNS Changer            "
echo "=========================================="
echo "Select a DNS provider to use:"
echo ""

options=("Google (8.8.8.8)" "Cloudflare (1.1.1.1)" "Quad9 (9.9.9.9)" "AdGuard (94.140.14.14)" "OpenDNS (208.67.222.222)" "Custom DNS" "Restore Backup" "Quit")
PS3="Please enter your choice (1-8): "

select opt in "${options[@]}"
do
    case $opt in
        "Google (8.8.8.8)")
            set_dns "Google" "8.8.8.8" "8.8.4.4"
            break
            ;;
        "Cloudflare (1.1.1.1)")
            set_dns "Cloudflare" "1.1.1.1" "1.0.0.1"
            break
            ;;
        "Quad9 (9.9.9.9)")
            set_dns "Quad9" "9.9.9.9" "149.112.112.112"
            break
            ;;
        "AdGuard (94.140.14.14)")
            set_dns "AdGuard" "94.140.14.14" "94.140.15.15"
            break
            ;;
        "OpenDNS (208.67.222.222)")
            set_dns "OpenDNS" "208.67.222.222" "208.67.220.220"
            break
            ;;
        "Custom DNS")
            read -p "Enter Primary DNS: " custom1
            read -p "Enter Secondary DNS (optional): " custom2
            set_dns "Custom" "$custom1" "$custom2"
            break
            ;;
        "Restore Backup")
            if [ -f /etc/resolv.conf.bak ]; then
                echo "Restoring original /etc/resolv.conf..."
                sudo cp /etc/resolv.conf.bak /etc/resolv.conf
                echo "Backup restored!"
            else
                echo "No backup found."
            fi
            break
            ;;
        "Quit")
            echo "Exiting..."
            exit 0
            ;;
        *) echo "Invalid option $REPLY. Please choose 1-8.";;
    esac
done
