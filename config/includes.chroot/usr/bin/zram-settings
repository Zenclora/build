#!/bin/bash

# Zram Settings Tool
# Allows installing, enabling, and disabling Zram, and provides information.

set -e

install_zram() {
    echo "--- Installing Zram Tools ---"
    sudo apt update
    sudo apt install -y zram-tools
    echo "Zram tools installed!"
}

enable_zram() {
    echo "--- Enabling Zram ---"
    # Ensure service is enabled and started
    sudo systemctl enable zramswap
    sudo systemctl start zramswap
    echo "Zram service enabled and started!"
}

disable_zram() {
    echo "--- Disabling Zram ---"
    # Ensure service is stopped and disabled
    sudo systemctl stop zramswap
    sudo systemctl disable zramswap
    echo "Zram service stopped and disabled!"
}

show_about() {
    echo "--- About Zram ---"
    echo "zRam is a Linux kernel module that creates a compressed block device in RAM."
    echo "The block device created with zRam can then be used for swap or as a general-purpose RAM disk."
    echo ""
    echo "Benefits:"
    echo "1. Performance: Compressed swap in RAM is much faster than swapping to disk (HDD/SSD)."
    echo "2. Life Extension: Reduces writes to SSDs, extending their life."
    echo "3. Memory Efficiency: Allows you to fit more data into memory than its physical capacity."
    echo ""
    read -p "Press Enter to return to the menu..."
}

# Clear screen for better UX
clear
echo "=========================================="
echo "         Zram Settings Manager            "
echo "=========================================="
echo "Manage your system's Zram configuration."
echo ""

options=("Install Zram" "Enable" "Disable" "About" "Exit")
PS3="Please enter your choice (1-5): "

select opt in "${options[@]}"
do
    case $opt in
        "Install Zram")
            install_zram
            break
            ;;
        "Enable")
            enable_zram
            break
            ;;
        "Disable")
            disable_zram
            break
            ;;
        "About")
            show_about
            # Re-run menu after showing info
            exec "$0"
            ;;
        "Exit")
            echo "Exiting..."
            exit 0
            ;;
        *) echo "Invalid option $REPLY. Please choose 1-5.";;
    esac
done
